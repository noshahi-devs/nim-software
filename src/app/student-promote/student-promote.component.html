<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <div class="card h-100 p-0 radius-12">
    <!-- Header Toolbar -->
    <div
      class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between"
    >
      <div class="d-flex align-items-center flex-wrap gap-3">
        <span class="text-md fw-medium text-secondary-light mb-0">Show</span>
        <select
          class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px"
          [(ngModel)]="rowsPerPage"
          (change)="currentPage = 1"
        >
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>

        <!-- Search -->
        <form class="navbar-search">
          <input
            type="text"
            class="bg-base h-40-px w-auto"
            [(ngModel)]="searchTerm"
            (input)="searchStudents()"
            name="search"
            placeholder="Search by Name, Roll No, Class..."
          />
          <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
        </form>

        <!-- Class & Section Filters -->
        <select
          class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px"
          [(ngModel)]="selectedClass"
          (change)="filterStudents()"
        >
          <option value="">All Classes</option>
          <option *ngFor="let c of classes" [value]="c">{{ c }}</option>
        </select>

        <select
          class="form-select form-select-sm w-auto ps-12 py-6 radius-12 h-40-px"
          [(ngModel)]="selectedSection"
          (change)="filterStudents()"
        >
          <option value="">All Sections</option>
          <option *ngFor="let s of sections" [value]="s">{{ s }}</option>
        </select>
      </div>
    </div>

    <!-- Table -->
    <div class="card-body p-24">
      <div class="table-responsive scroll-sm">
        <table class="table bordered-table sm-table mb-0">
          <thead>
            <tr>
              <th>
                <label class="d-flex align-items-center justify-content-center">
  <input
    type="checkbox"
    class="form-check-input"
    style="width: 16px; height: 16px;"
    (change)="toggleAllSelections($event)"
    [checked]="areAllSelected()"
  />
</label>

              </th>
              <th scope="col">S.L</th>
              <th scope="col">Name</th>
              <th scope="col">Roll No</th>
              <th scope="col">Class</th>
              <th scope="col">Section</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of paginatedStudents; let i = index">
              <td>
               <label class="d-flex align-items-center justify-content-center">
  <input
    type="checkbox"
    class="form-check-input"
    style="width: 16px; height: 16px;"
    [checked]="selectedStudents.includes(student.id)"
    (change)="toggleSelection(student.id)"
  />
</label>

              </td>
              <td>{{ (currentPage - 1) * rowsPerPage + i + 1 }}</td>
              <td>{{ student.name }}</td>
              <td>{{ student.rollNo }}</td>
              <td>{{ student.class }}</td>
              <td>{{ student.section }}</td>
              <td>
  <span
    *ngIf="student.status === 'active'"
    class="bg-success-focus text-success-600 border border-success-main px-24 py-4 radius-4 fw-medium text-sm"
  >
    Active
  </span>
  <span
    *ngIf="student.status === 'inactive'"
    class="bg-danger-focus text-danger-600 border border-danger-main px-24 py-4 radius-4 fw-medium text-sm"
  >
    Inactive
  </span>
              </td>

            </tr>
            <tr *ngIf="paginatedStudents.length === 0">
              <td colspan="7" class="text-center py-24 text-secondary-light">
                No students found
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div
        class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-24"
      >
        <span
          >Showing {{ (currentPage - 1) * rowsPerPage + 1 }} to
          {{ Math.min(currentPage * rowsPerPage, filteredStudents.length) }} of
          {{ filteredStudents.length }} entries</span
        >

        <ul
          class="pagination d-flex flex-wrap align-items-center gap-2 justify-content-center"
        >
          <li class="page-item">
            <a
              class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.disabled]="currentPage === 1"
              (click)="changePage(currentPage - 1)"
              href="javascript:void(0)"
            >
              <iconify-icon icon="ep:d-arrow-left"></iconify-icon>
            </a>
          </li>
          <li
            class="page-item"
            *ngFor="let page of [].constructor(totalPages); let i = index"
          >
            <a
              class="page-link fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.bg-primary-600]="currentPage === i + 1"
              [class.text-white]="currentPage === i + 1"
              [class.bg-neutral-200]="currentPage !== i + 1"
              [class.text-secondary-light]="currentPage !== i + 1"
              (click)="changePage(i + 1)"
              href="javascript:void(0)"
            >
              {{ i + 1 }}
            </a>
          </li>
          <li class="page-item">
            <a
              class="page-link bg-neutral-200 text-secondary-light fw-semibold radius-8 border-0 d-flex align-items-center justify-content-center h-32-px w-32-px text-md"
              [class.disabled]="currentPage === totalPages"
              (click)="changePage(currentPage + 1)"
              href="javascript:void(0)"
            >
              <iconify-icon icon="ep:d-arrow-right"></iconify-icon>
            </a>
          </li>
        </ul>
      </div>

      <!-- Promotion Section -->
      <div class="row mt-24 g-3">
        <div class="col-md-4">
          <label class="fw-semibold mb-8">Next Class</label>
          <select class="form-select" [(ngModel)]="nextClass">
            <option value="">Select Class</option>
            <option *ngFor="let c of classes" [value]="c">{{ c }}</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="fw-semibold mb-8">Next Section</label>
          <select class="form-select" [(ngModel)]="nextSection">
            <option value="">Select Section</option>
            <option *ngFor="let s of sections" [value]="s">{{ s }}</option>
          </select>
        </div>

        <div class="col-md-4 d-flex align-items-end">
          <button
            class="btn btn-primary w-100"
            (click)="promoteSelected()"
            [disabled]="selectedStudents.length === 0"
          >
            Promote Selected Students
          </button>
        </div>
      </div>
    </div>
  </div>
<!-- ✅ Confirmation Modal -->
<div
  class="modal fade"
  id="confirmationModal"
  tabindex="-1"
  aria-labelledby="confirmationModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content radius-12 p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title text-primary fw-semibold" id="confirmationModalLabel">
          Confirm Promotion
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        Are you sure you want to promote the selected students to 
        <b>{{ nextClass || 'Next Class' }}</b> - 
        <b>{{ nextSection || 'Next Section' }}</b>?
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button
          type="button"
          class="btn btn-secondary px-4"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary px-4"
          (click)="confirmPromotion()"
        >
          Yes, Promote
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Success Modal -->
<div
  class="modal fade"
  id="successModal"
  tabindex="-1"
  aria-labelledby="successModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content radius-12 p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title text-success fw-semibold" id="successModalLabel">
          Promotion Successful!
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        Selected students have been promoted successfully to 
        <b>{{ nextClass }}</b> - <b>{{ nextSection }}</b>.
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button
          type="button"
          class="btn btn-success px-4"
          data-bs-dismiss="modal"
        >
          OK
        </button>
      </div>
    </div>
  </div>
</div>


</div>
