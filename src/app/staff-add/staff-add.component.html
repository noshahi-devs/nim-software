<div class="dashboard-main-body">
  <app-breadcrumb [title]="title"></app-breadcrumb>

  <div class="card h-100 p-0 radius-12">
    <div class="card-header border-bottom bg-base py-16 px-24">
      <form
        #staffForm="ngForm"
        (ngSubmit)="onSubmit(staffForm)"
        novalidate
        class="staff-form"
      >
        <div class="form-section mb-4">
          <h5 class="section-title fw-semibold mb-2">
            <span class="number">①</span> Basic Information
          </h5>
          <hr />

          <div class="row g-3 p-12">
            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Staff Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control radius-8"
                name="name"
                placeholder="Enter Name"
                [(ngModel)]="newStaff.name"
                #name="ngModel"
                required
                [ngClass]="{ 'is-invalid': name.invalid && name.touched }"
              />
              <small *ngIf="name.invalid && name.touched" class="text-danger">
                This field is required
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Mobile No <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control radius-8"
                name="phone"
                placeholder="0300-1234567"
                [(ngModel)]="newStaff.phone"
                pattern="^03\d{2}-\d{7}$"
                #phone="ngModel"
                required
                [ngClass]="{ 'is-invalid': phone.invalid && phone.touched }"
              />
              <small *ngIf="phone.errors?.['required'] && phone.touched" class="text-danger">
                This field is required
              </small>
              <small *ngIf="phone.errors?.['pattern'] && phone.touched" class="text-danger">
                Invalid format
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">Add Picture</label>
              <input
                type="file"
                class="form-control radius-8"
                id="imageUpload"
                accept=".png, .jpg, .jpeg"
              />
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Joining Date <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control radius-8"
                name="joiningDate"
                [(ngModel)]="newStaff.joiningDate"
                #joiningDate="ngModel"
                required
                [ngClass]="{
                  'is-invalid': joiningDate.invalid && joiningDate.touched
                }"
              />
              <small *ngIf="joiningDate.invalid && joiningDate.touched" class="text-danger">
                This field is required
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">CNIC</label>
              <input
                type="text"
                class="form-control radius-8"
                name="cnic"
                placeholder="33301-1234567-1"
                [(ngModel)]="newStaff.cnic"
                pattern="^\d{5}-\d{7}-\d{1}$"
                #cnic="ngModel"
                [ngClass]="{ 'is-invalid': cnic.invalid && cnic.touched }"
              />
              <small *ngIf="cnic.invalid && cnic.touched" class="text-danger">
                This field is required
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Role <span class="text-danger">*</span>
              </label>
              <select
                class="form-control radius-8 form-select"
                name="role"
                [(ngModel)]="newStaff.role"
                #role="ngModel"
                required
                [ngClass]="{ 'is-invalid': role.invalid && role.touched }"
              >
                <option value="">Select Role</option>
                <option value="Teacher">Teacher</option>
                <option value="Principal">Principal</option>
                <option value="Admin">Admin</option>
                <option value="Accountant">Accountant</option>
              </select>
              <small *ngIf="role.invalid && role.touched" class="text-danger">
                This field is required
              </small>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h5 class="section-title fw-semibold mb-2">
            <span class="number">②</span> Other Information
          </h5>
          <hr />

          <div class="row g-3 p-12">
            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">Experience</label>
              <select
                class="form-control radius-8 form-select"
                [(ngModel)]="newStaff.experience"
                name="experience"
              >
                <option value="">Select Experience</option>
                <option value="Fresh">Fresh</option>
                <option value="1+">1+ Year</option>
                <option value="2+">2+ Year</option>
                <option value="3+">3+ Year</option>
                <option value="4+">4+ Year</option>
                <option value="5+">5+ Year</option>
                <option value="10+">10+ Year</option>
                <option value="Other">Other</option>
              </select>

              <input
                *ngIf="newStaff.experience === 'Other'"
                type="text"
                class="form-control mt-2 radius-8"
                placeholder="Enter experience in years/months"
                [(ngModel)]="newStaff.customExperience"
                name="customExperience"
              />
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Gender <span class="text-danger">*</span>
              </label>
              <select
                class="form-control radius-8 form-select"
                name="gender"
                [(ngModel)]="newStaff.gender"
                #gender="ngModel"
                required
                [ngClass]="{ 'is-invalid': gender.invalid && gender.touched }"
              >
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
              <small *ngIf="gender.invalid && gender.touched" class="text-danger">
                This field is required
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Date of Birth <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control radius-8"
                name="dob"
                [(ngModel)]="newStaff.dob"
                #dob="ngModel"
                required
                [ngClass]="{ 'is-invalid': dob.invalid && dob.touched }"
              />
              <small *ngIf="dob.invalid && dob.touched" class="text-danger">
                This field is required
              </small>
            </div>
<!-- 
            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Qualification <span class="text-danger">*</span>
              </label>
              <select
                class="form-control radius-8 form-select"
                name="qualification"
                [(ngModel)]="newStaff.qualification"
                #qualification="ngModel"
                required
                [ngClass]="{
                  'is-invalid': qualification.invalid && qualification.touched
                }"
              >
                <option value="">Select Qualification</option>
                <option value="masters">Masters</option>
                <option value="bachelors">Bachelors</option>
                <option value="associateDegree">Associate Degree</option>
                <option value="diploma">DAE</option>
                <option value="intermediate">Intermediate</option>
                <option value="matriculation">Matriculation</option>
                <option value="middle">Middle</option>
                <option value="primary">Primary</option>
                <option value="na">N/A</option>
              </select>
              <small
                *ngIf="qualification.invalid && qualification.touched"
                class="text-danger"
              >
                This field is required
              </small>
            </div> -->

            <!-- Qualification -->
<div class="col-12 col-sm-6 col-md-4">
  <label class="form-label">
    Qualification <span class="text-danger">*</span>
  </label>
  <select
    class="form-control radius-8 form-select"
    name="qualification"
    [(ngModel)]="newStaff.qualification"
    #qualification="ngModel"
    required
    [ngClass]="{
      'is-invalid': qualification.invalid && qualification.touched
    }"
  >
    <option value="">Select Qualification</option>
    <option value="masters">Masters</option>
    <option value="bachelors">Bachelors</option>
    <option value="associateDegree">Associate Degree</option>
    <option value="diploma">DAE</option>
    <option value="intermediate">Intermediate</option>
    <option value="matriculation">Matriculation</option>
    <option value="middle">Middle</option>
    <option value="primary">Primary</option>
    <option value="na">N/A</option>
  </select>
  <small
    *ngIf="qualification.invalid && qualification.touched"
    class="text-danger"
  >
    This field is required
  </small>
</div>

<!-- Associate Degree Duration -->
<div
  class="col-12 col-sm-6 col-md-4"
  *ngIf="newStaff.qualification === 'associateDegree'"
>
  <label class="form-label">
    Program Duration <span class="text-danger">*</span>
  </label>
  <select
    class="form-control radius-8 form-select"
    [(ngModel)]="newStaff.programDuration"
    name="programDuration"
    #programDuration="ngModel"
    required
    [ngClass]="{
      'is-invalid': programDuration.invalid && programDuration.touched
    }"
  >
    <option value="">Select Duration</option>
    <option value="2-year">2-Year Program</option>
    <option value="4-year">4-Year Program</option>
  </select>
  <small
    *ngIf="programDuration.invalid && programDuration.touched"
    class="text-danger"
  >
    This field is required
  </small>
</div>

<!-- Subject Dropdown (Associate/Bachelors) -->
<div
  class="col-12 col-sm-6 col-md-4"
  *ngIf="newStaff.qualification === 'bachelors' || newStaff.qualification === 'associateDegree'"
>
  <label class="form-label">
    Subject <span class="text-danger">*</span>
  </label>
  <select
    class="form-control radius-8 form-select"
    [(ngModel)]="newStaff.subject"
    name="subject"
    #subject="ngModel"
    required
    [ngClass]="{
      'is-invalid': subject.invalid && subject.touched
    }"
  >
    <option value="">Select Subject</option>

    <!-- Associate Degree Subjects -->
    <ng-container *ngIf="newStaff.qualification === 'associateDegree'">
      <option value="arts">Arts</option>
      <option value="science">Science</option>
      <option value="commerce">Commerce</option>
      <option value="computerScience">Computer Science</option>
    </ng-container>

    <!-- Bachelors Subjects -->
    <ng-container *ngIf="newStaff.qualification === 'bachelors'">
      <option value="bsComputerScience">BS Computer Science</option>
      <option value="bsEnglish">BS English</option>
      <option value="bsMath">BS Mathematics</option>
      <option value="bsPhysics">BS Physics</option>
      <option value="bsChemistry">BS Chemistry</option>
      <option value="bsEconomics">BS Economics</option>
      <option value="bsEducation">BS Education</option>
      <option value="bsIslamicStudies">BS Islamic Studies</option>
    </ng-container>

    <option value="other">Other</option>
  </select>
  <small *ngIf="subject.invalid && subject.touched" class="text-danger">
    This field is required
  </small>
</div>

<!-- Custom Subject Input (Editable field) -->
<div
  class="col-12 col-sm-6 col-md-4"
  *ngIf="newStaff.subject === 'other'"
>
  <label class="form-label">Other Subject <span class="text-danger">*</span></label>
  <input
    type="text"
    class="form-control radius-8"
    name="customSubject"
    placeholder="Enter subject name"
    [(ngModel)]="newStaff.customSubject"
    #customSubject="ngModel"
    required
    [ngClass]="{
      'is-invalid': customSubject.invalid && customSubject.touched
    }"
  />
  <small
    *ngIf="customSubject.invalid && customSubject.touched"
    class="text-danger"
  >
    This field is required
  </small>
</div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">Email</label>
              <div class="position-relative">
                <input
                  type="email"
                  class="form-control radius-8 email-input-with-icon"
                  name="email"
                  placeholder="user@example.com"
                  [(ngModel)]="newStaff.email"
                  (keyup)="validateEmail()"
                  #email="ngModel"
                  [ngClass]="{ 
                    'is-invalid': email.invalid && email.touched,
                    'email-valid': validateEmail().isValid,
                    'email-invalid': !validateEmail().isValid && newStaff.email !== ''
                  }"
                />
                <iconify-icon 
                  *ngIf="validateEmail().isValid"
                  icon="mdi:check-circle"
                  class="email-icon email-icon-valid"
                ></iconify-icon>
                <iconify-icon 
                  *ngIf="!validateEmail().isValid && newStaff.email !== ''"
                  icon="mdi:close-circle"
                  class="email-icon email-icon-invalid"
                ></iconify-icon>
              </div>
              <small 
                *ngIf="!validateEmail().isValid && newStaff.email !== ''"
                class="text-danger d-block mt-1"
              >
                Please enter valid email address
              </small>
            </div>

            <div class="col-12 col-sm-6 col-md-4">
              <label class="form-label">
                Status <span class="text-danger">*</span>
              </label>
              <select
                class="form-control radius-8 form-select"
                  name="status"
                [(ngModel)]="newStaff.status"
                #status="ngModel"
                required
                [ngClass]="{ 'is-invalid': status.invalid && status.touched }"
              >
                <option value="">Select Status</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
              </select>
              <small *ngIf="status.invalid && status.touched" class="text-danger">
                This field is required
              </small>
            </div>

            <div class="col-12">
              <label class="form-label">
                Address <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control radius-8"
                rows="3"
                name="address"
                placeholder="Village 97 JB, Gojra, Toba Tek Singh"
                [(ngModel)]="newStaff.address"
                #address="ngModel"
                required
                [ngClass]="{ 'is-invalid': address.invalid && address.touched }"
              ></textarea>
              <small *ngIf="address.invalid && address.touched" class="text-danger">
                This field is required
              </small>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-center gap-3 mt-4">
          <button
            type="button"
            (click)="cancel()"
            class="border border-danger-600 bg-hover-danger-200 text-danger-600 text-md px-56 py-11 radius-8"
          >
            Cancel
          </button>

          <button
            type="submit"
            class="btn btn-primary border border-primary-600 text-md px-56 py-12 radius-8"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <div
    class="modal fade"
    id="validationModal"
    tabindex="-1"
    aria-labelledby="validationModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content radius-12 p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title text-danger fw-semibold" id="validationModalLabel">
            Form Incomplete
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body text-center">
          Please fill in all required fields (marked with *)
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button
            type="button"
            class="btn btn-primary px-4"
            data-bs-dismiss="modal"
          >
            OK
          </button>
        </div>
      </div>
    </div>
  </div>

  <div
    class="modal fade"
    id="successModal"
    tabindex="-1"
    aria-labelledby="successModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content radius-12 p-3">
        <div class="modal-header border-0">
          <h5 class="modal-title text-success fw-semibold" id="successModalLabel">
            Success!
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body text-center">
          Staff added successfully!
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button
            type="button"
            class="btn btn-success px-4"
            data-bs-dismiss="modal"
          >
            OK
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
